
<html><head><link rel="stylesheet" href="trac.css" type="text/css" />
</head><body>

<h1 id="CustomizingtheTracInterface">Customizing the Trac Interface</h1>
<p>
<div class="system-message"><strong>Error: Macro TracGuideToc(None) failed</strong><pre>'NoneType' object has no attribute 'find'</pre></div>
</p><div class="wiki-toc">
<ol>
  <li>
    <a href="#CustomizingtheTracInterface">Customizing the Trac Interface</a>
    <ol>
      <li>
        <a href="#Introduction">Introduction</a>
      </li>
      <li>
        <a href="#ProjectLogoandIcon">Project Logo and Icon</a>
        <ol>
          <li>
            <a href="#Logo">Logo</a>
          </li>
          <li>
            <a href="#Icon">Icon</a>
          </li>
        </ol>
      </li>
      <li>
        <a href="#CustomNavigationEntries">Custom Navigation Entries</a>
      </li>
      <li>
        <a href="#SiteAppearance">Site Appearance</a>
      </li>
      <li>
        <a href="#ProjectList">Project List</a>
      </li>
      <li>
        <a href="#ProjectTemplates">Project Templates</a>
      </li>
    </ol>
  </li>
</ol>
</div><p>
</p>
<h2 id="Introduction">Introduction</h2>
<p>
This page is meant to give users suggestions on how they can customize the look of Trac.  Topics on this page cover editing the HTML templates and CSS files, but not the program code itself.  The topics are intended to show users how they can modify the look of Trac to meet their specific needs.  Suggestions for changes to Trac's interface applicable to all users should be filed as tickets, not listed on this page.
</p>
<h2 id="ProjectLogoandIcon">Project Logo and Icon</h2>
<p>
The easiest parts of the Trac interface to customize are the logo and the site icon.  Both of these can be configured with settings in <a class="wiki" href="TracIni.html" rel="follow">trac.ini</a>.
</p>
<p>
The logo or icon image should be put in a folder named "htdocs" in your project's environment folder.  (<em>Note: in projects created with a Trac version prior to 0.9 you will need to create this folder</em>)
</p>
<blockquote>
<p>
<em>Note: you can actually put the logo and icon anywhere on your server (as long as it's accessible through the web server), and use their absolute or server-relative URLs in the configuration.</em>
</p>
</blockquote>
<p>
Now configure the appropriate section of your <a class="wiki" href="TracIni.html" rel="follow">trac.ini</a>:
</p>
<h3 id="Logo">Logo</h3>
<p>
Change the <tt>src</tt> setting to <tt>site/</tt> followed by the name of your image file.  The <tt>width</tt> and <tt>height</tt> settings should be modified to match your image's dimensions (the Trac chrome handler uses "<tt>site/</tt>" for files within the project directory <tt>htdocs</tt>, and "<tt>common/</tt>" for the common <tt>htdocs</tt> directory belonging to a Trac installation). Note that 'site/' is not a placeholder for your project name, it is the actual prefix that should be used (literally). For example, if your project is named 'sandbox', and the image file is 'red_logo.gif' then the 'src' setting would be 'site/red_logo.gif', not 'sandbox/red_logo.gif'.
</p>
<pre class="wiki">[header_logo]
src = site/my_logo.gif
alt = My Project
width = 300
height = 100
</pre><h3 id="Icon">Icon</h3>
<p>
Icons should be a 32x32 image in <tt>.gif</tt> or <tt>.ico</tt> format.  Change the <tt>icon</tt> setting to <tt>site/</tt> followed by the name of your icon file.  Icons will typically be displayed by your web browser next to the site's URL and in the <tt>Bookmarks</tt> menu.
</p>
<pre class="wiki">[project]
icon = site/my_icon.ico
</pre><p>
Note though that this icon is ignored by Internet Explorer, which only accepts a file named <tt></tt>favicon.ico<tt></tt> at the root of the host. To make the project icon work in both IE and other browsers, you can store the icon in the document root of the host, and reference it from <tt></tt>trac.ini<tt></tt> as follows:
</p>
<pre class="wiki">[project]
icon = /favicon.ico
</pre><p>
Should your browser have issues with your favicon showing up in the address bar, you may put a "" (less the quotation marks) after your favicon file extension. 
</p>
<pre class="wiki">[project]
icon = /favicon.ico
</pre><h2 id="CustomNavigationEntries">Custom Navigation Entries</h2>
<p>
The new [mainnav] and [metanav] can now be used to customize the text and link used for the navigation items, or even to disable them (but not for adding new ones).
</p>
<p>
In the following example, we rename the link to the Wiki start "Home", and hide the "Help/Guide". We also make the "View Tickets" entry link to a specific report .
</p>
<pre class="wiki">[mainnav]
wiki.label = Home
tickets.href = /report/24

[metanav]
help = disabled
</pre><p>
See also <a class="wiki" href="TracNavigation.html" rel="follow">TracNavigation</a> for a more detailed explanation of the mainnav and metanav terms.
</p>
<h2 id="SiteAppearance">Site Appearance</h2>
<p>
Trac is using <a class="ext-link" href="http://genshi.edgewall.org"><span class="icon">​</span>Genshi</a> as the templating engine. Documentation is yet to be written, in the meantime the following tip should work.
</p>
<p>
Say you want to add a link to a custom stylesheet, and then your own
header and footer. Save the following content as <tt>site.html</tt> inside your projects <tt>templates/</tt> directory (each Trac project can have their own <tt>site.html</tt>), e.g. <tt>/path/to/env/templates/site.html</tt>:
</p>
<div class="code"><pre>&lt;html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/"
      py:strip=""&gt;

  &lt;!--! Add site-specific style sheet --&gt;
  &lt;head py:match="head" py:attrs="select('@*')"&gt;
    ${select('*|comment()|text()')}
    &lt;link rel="stylesheet" type="text/css"
          href="${href.chrome('site/style.css')}" /&gt;
  &lt;/head&gt;

  &lt;body py:match="body" py:attrs="select('@*')"&gt;
    &lt;!--! Add site-specific header --&gt;
    &lt;div id="siteheader"&gt;
      &lt;!--! Place your header content here... --&gt;
    &lt;/div&gt;

    ${select('*|text()')}

    &lt;!--! Add site-specific footer --&gt;
    &lt;div id="sitefooter"&gt;
      &lt;!--! Place your footer content here... --&gt;
    &lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;
</pre></div><p>
Those who are familiar with XSLT may notice that Genshi templates bear some similarities. However, there are some Trac specific features - for example <tt>${href.chrome('site/style.css')}</tt> attribute references a CSS file placed into environment's <tt>htdocs/</tt> directory. In a similar fashion <tt>${chrome.htdocs_location}</tt> is used to specify the common <tt>htdocs/</tt> directory belonging to a Trac installation. That latter location can however be overriden using the <a class="wiki" href="TracIni#trac-config.html" rel="follow">[trac] htdocs_location</a> configuration setting.
</p>
<p>
<tt>site.html</tt> is one file to contain all your modifications. It usually works using the <tt>py:match</tt> directive (element or attribute), and it allows you to modify the page as it renders - the matches hook onto specific sections depending on what it tries to find
and modify them.
See <a class="ext-link" href="http://groups.google.com/group/trac-users/browse_thread/thread/70487fb2c406c937/"><span class="icon">​</span>this thread</a> for a detailed explanation of the above example <tt>site.html</tt>.
A <tt>site.html</tt> can contain any number of such <tt>py:match</tt> sections for whatever you need to modify. This is all Genshi, so the <a class="ext-link" href="http://genshi.edgewall.orgDocumentation/xml-templates.html.html"><span class="icon">​</span>docs on the exact syntax</a> can be found there.
</p>
<p>
Example snippet of adding introduction text to the new ticket form (but not shown during preview):
</p>
<div class="code"><pre>&lt;form py:match="div[@id='content' and @class='ticket']/form" py:attrs="select('@*')"&gt;
  &lt;py:if test="req.environ['PATH_INFO'] == '/newticket' and (not 'preview' in req.args)"&gt;
    &lt;p&gt;Please make sure to search for existing tickets before reporting a new one!&lt;/p&gt;
  &lt;/py:if&gt;
  ${select('*')} 
&lt;/form&gt;
</pre></div><p>
This example illustrates a technique of using <tt>req.environ['PATH_INFO']</tt> to limit scope of changes to one view only. For instance, to make changes in <tt>site.html</tt> only for timeline and avoid modifying other sections - use  <tt>req.environ['PATH_INFO'] == '/timeline'</tt> condition in <tt>&lt;py:if&gt;</tt> test.
</p>
<p>
More examples snippets for <tt>site.html</tt> can be found at <a class="ext-link" href="http://trac.edgewall.org/intertrac/wiki%3ACookBook/SiteHtml" title="wiki:CookBook/SiteHtml in Trac project trac"><span class="icon">​</span>CookBook/SiteHtml</a>.
</p>
<p>
Example snippets for <tt>style.css</tt> can be found at <a class="ext-link" href="http://trac.edgewall.org/intertrac/wiki%3ACookBook/SiteStyleCss" title="wiki:CookBook/SiteStyleCss in Trac project trac"><span class="icon">​</span>CookBook/SiteStyleCss</a>.
</p>
<p>
If the environment is upgraded from 0.10 and a <tt>site_newticket.cs</tt> file already exists, it can actually be loaded by using a workaround - providing it contains no <a class="wiki" href="ClearSilver.html" rel="follow">ClearSilver</a> processing. In addition, as only one element can be imported, the content needs some sort of wrapper such as a <tt>&lt;div&gt;</tt> block or other similar parent container. The XInclude namespace must be specified to allow includes, but that can be moved to document root along with the others:
</p>
<div class="code"><pre>&lt;form py:match="div[@id='content' and @class='ticket']/form" py:attrs="select('@*')"
        xmlns:xi="http://www.w3.org/2001/XInclude"&gt;
  &lt;py:if test="req.environ['PATH_INFO'] == '/newticket' and (not 'preview' in req.args)"&gt; 
    &lt;xi:include href="site_newticket.cs"&gt;&lt;xi:fallback /&gt;&lt;/xi:include&gt;
  &lt;/py:if&gt;
  ${select('*')} 
&lt;/form&gt;
</pre></div><p>
Also note that the <tt>site.html</tt> (despite its name) can be put in a common templates directory - see the <a class="wiki" href="TracIni#inherit-section.html" rel="follow">[inherit] templates_dir</a> option. This could provide easier maintainence (and a migration path from 0.10 for larger installations) as one new global <tt>site.html</tt> file can be made to include any existing header, footer and newticket snippets.
</p>
<h2 id="ProjectList">Project List</h2>
<p>
You can use a custom Genshi template to display the list of projects if you are using Trac with multiple projects.  
</p>
<p>
The following is the basic template used by Trac to display a list of links to the projects.  For projects that could not be loaded it displays an error message. You can use this as a starting point for your own index template.
</p>
<div class="code"><pre>&lt;!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"&gt;
&lt;html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/"
      xmlns:xi="http://www.w3.org/2001/XInclude"&gt;
  &lt;head&gt;
    &lt;title&gt;Available Projects&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Available Projects&lt;/h1&gt;
    &lt;ul&gt;
      &lt;li py:for="project in projects" py:choose=""&gt;
        &lt;a py:when="project.href" href="$project.href"
           title="$project.description"&gt;$project.name&lt;/a&gt;
        &lt;py:otherwise&gt;
          &lt;small&gt;$project.name: &lt;em&gt;Error&lt;/em&gt; &lt;br /&gt; ($project.description)&lt;/small&gt;
        &lt;/py:otherwise&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/body&gt;
&lt;/html&gt;
</pre></div><p>
Once you've created your custom template you will need to configure the webserver to tell Trac where the template is located (pls verify ... not yet changed to 0.11):
</p>
<p>
For <a class="wiki" href="TracModWSGI.html" rel="follow">mod_wsgi</a>:
</p>
<pre class="wiki">os.environ['TRAC_ENV_INDEX_TEMPLATE'] = '/path/to/template'
</pre><p>
For <a class="wiki" href="TracFastCgi.html" rel="follow">FastCGI</a>:
</p>
<pre class="wiki">FastCgiConfig -initial-env TRAC_ENV_PARENT_DIR=/parent/dir/of/projects \
              -initial-env TRAC_ENV_INDEX_TEMPLATE=/path/to/template
</pre><p>
For <a class="wiki" href="TracModPython.html" rel="follow">mod_python</a>:
</p>
<pre class="wiki">PythonOption TracEnvParentDir /parent/dir/of/projects
PythonOption TracEnvIndexTemplate /path/to/template
</pre><p>
For <a class="wiki" href="TracCgi.html" rel="follow">CGI</a>:
</p>
<pre class="wiki">SetEnv TRAC_ENV_INDEX_TEMPLATE /path/to/template
</pre><p>
For <a class="wiki" href="TracStandalone.html" rel="follow">TracStandalone</a>, you'll need to set up the <tt>TRAC_ENV_INDEX_TEMPLATE</tt> environment variable in the shell used to launch tracd:
</p>
<ul><li>Unix
<div class="code"><pre>$ export TRAC_ENV_INDEX_TEMPLATE=/path/to/template
</pre></div></li><li>Windows
<div class="code"><pre>$ set TRAC_ENV_INDEX_TEMPLATE=/path/to/template
</pre></div></li></ul><h2 id="ProjectTemplates">Project Templates</h2>
<p>
The appearance of each individual Trac environment (that is, instance of a project) can be customized independently of other projects, even those hosted by the same server. The recommended way is to use a <tt>site.html</tt> template (see <a href="/Wiki#SiteAppearance">#SiteAppearance</a>) whenever possible. Using <tt>site.html</tt> means changes are made to the original templates as they are rendered, and you should not normally need to redo modifications whenever Trac is upgraded. If you do make a copy of <tt>theme.html</tt> or any other Trac template, you need to migrate your modifiations to the newer version - if not, new Trac features or bug fixes may not work as expected.
</p>
<p>
With that word of caution, any Trac template may be copied and customized. The default Trac templates are located inside the installed Trac egg (<tt>/usr/lib/pythonVERSION/site-packages/Trac-VERSION.egg/trac/templates, .../trac/ticket/templates, .../tractemplates, ++</tt>). The <a href=.html"/Wiki#ProjectList">#ProjectList</a> template file is called <tt>index.html</tt>, while the template responsible for main layout is called <tt>theme.html</tt>. Page assets such as images and CSS style sheets are located in the egg's <tt>trac/htdocs</tt> directory.
</p>
<p>
However, do not edit templates or site resources inside the Trac egg - installing Trac again can completely delete your modifications. Instead use one of two alternatives:
</p>
<ul><li>For a modification to one project only, copy the template to project <tt>templates</tt> directory.
</li><li>For a modification shared by several projects, copy the template to a shared location and have each project point to this location using the <tt>[inherit] templates_dir =</tt> trac.ini option.
</li></ul><p>
Trac resolves requests for a template by first looking inside the project, then in any inherited templates location, and finally inside the Trac egg.
</p>
<p>
Trac caches templates in memory by default to improve performance. To apply a template you need to restart the server.
</p>
<hr />
<p>
See also <a class="wiki" href="TracGuide.html" rel="follow">TracGuide</a>, <a class="wiki" href="TracIni.html" rel="follow">TracIni</a>
</p>


</body>
</html>


